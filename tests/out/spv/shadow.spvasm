; SPIR-V
; Version: 1.2
; Generator: rspirv
; Bound: 271
OpCapability Shader
OpExtension "SPV_KHR_storage_buffer_storage_class"
%1 = OpExtInstImport "GLSL.std.450"
OpMemoryModel Logical GLSL450
OpEntryPoint Vertex %89 "vs_main" %79 %82 %84 %86 %88
OpEntryPoint Fragment %149 "fs_main" %140 %143 %146 %148
OpEntryPoint Fragment %217 "fs_main_without_storage" %210 %212 %214 %216
OpExecutionMode %149 OriginUpperLeft
OpExecutionMode %217 OriginUpperLeft
OpMemberName %8 0 "view_proj"
OpMemberName %8 1 "num_lights"
OpName %8 "Globals"
OpMemberName %9 0 "world"
OpMemberName %9 1 "color"
OpName %9 "Entity"
OpMemberName %11 0 "proj_position"
OpMemberName %11 1 "world_normal"
OpMemberName %11 2 "world_position"
OpName %11 "VertexOutput"
OpMemberName %15 0 "proj"
OpMemberName %15 1 "pos"
OpMemberName %15 2 "color"
OpName %15 "Light"
OpName %24 "c_ambient"
OpName %18 "c_max_lights"
OpName %25 "u_globals"
OpName %28 "u_entity"
OpName %31 "s_lights"
OpName %34 "u_lights"
OpName %37 "t_shadow"
OpName %39 "sampler_shadow"
OpName %42 "light_id"
OpName %43 "homogeneous_coords"
OpName %44 "fetch_shadow"
OpName %75 "out"
OpName %79 "position"
OpName %82 "normal"
OpName %84 "proj_position"
OpName %86 "world_normal"
OpName %88 "world_position"
OpName %89 "vs_main"
OpName %133 "color"
OpName %135 "i"
OpName %140 "proj_position"
OpName %143 "world_normal"
OpName %146 "world_position"
OpName %149 "fs_main"
OpName %206 "color"
OpName %207 "i"
OpName %210 "proj_position"
OpName %212 "world_normal"
OpName %214 "world_position"
OpName %217 "fs_main_without_storage"
OpMemberDecorate %8 0 Offset 0
OpMemberDecorate %8 0 ColMajor
OpMemberDecorate %8 0 MatrixStride 16
OpMemberDecorate %8 1 Offset 64
OpMemberDecorate %9 0 Offset 0
OpMemberDecorate %9 0 ColMajor
OpMemberDecorate %9 0 MatrixStride 16
OpMemberDecorate %9 1 Offset 64
OpMemberDecorate %11 0 Offset 0
OpMemberDecorate %11 1 Offset 16
OpMemberDecorate %11 2 Offset 32
OpMemberDecorate %15 0 Offset 0
OpMemberDecorate %15 0 ColMajor
OpMemberDecorate %15 0 MatrixStride 16
OpMemberDecorate %15 1 Offset 64
OpMemberDecorate %15 2 Offset 80
OpDecorate %16 ArrayStride 96
OpDecorate %17 ArrayStride 96
OpDecorate %25 DescriptorSet 0
OpDecorate %25 Binding 0
OpDecorate %26 Block
OpMemberDecorate %26 0 Offset 0
OpDecorate %28 DescriptorSet 1
OpDecorate %28 Binding 0
OpDecorate %29 Block
OpMemberDecorate %29 0 Offset 0
OpDecorate %31 NonWritable
OpDecorate %31 DescriptorSet 0
OpDecorate %31 Binding 1
OpDecorate %32 Block
OpMemberDecorate %32 0 Offset 0
OpDecorate %34 DescriptorSet 0
OpDecorate %34 Binding 1
OpDecorate %35 Block
OpMemberDecorate %35 0 Offset 0
OpDecorate %37 DescriptorSet 0
OpDecorate %37 Binding 2
OpDecorate %39 DescriptorSet 0
OpDecorate %39 Binding 3
OpDecorate %79 Location 0
OpDecorate %82 Location 1
OpDecorate %84 BuiltIn Position
OpDecorate %86 Location 0
OpDecorate %88 Location 1
OpDecorate %140 BuiltIn FragCoord
OpDecorate %143 Location 0
OpDecorate %146 Location 1
OpDecorate %148 Location 0
OpDecorate %210 BuiltIn FragCoord
OpDecorate %212 Location 0
OpDecorate %214 Location 1
OpDecorate %216 Location 0
%2 = OpTypeVoid
%5 = OpTypeFloat 32
%4 = OpTypeVector %5 4
%3 = OpTypeMatrix %4 4
%7 = OpTypeInt 32 0
%6 = OpTypeVector %7 4
%8 = OpTypeStruct %3 %6
%9 = OpTypeStruct %3 %4
%10 = OpTypeVector %5 3
%11 = OpTypeStruct %4 %10 %4
%13 = OpTypeInt 32 1
%12 = OpTypeVector %13 4
%14 = OpTypeMatrix %10 3
%15 = OpTypeStruct %3 %4 %4
%16 = OpTypeRuntimeArray %15
%18 = OpConstant  %7  10
%17 = OpTypeArray %15 %18
%19 = OpTypeImage %5 2D 1 1 0 1 Unknown
%20 = OpTypeSampler
%21 = OpTypeVector %5 2
%22 = OpConstant  %13  10
%23 = OpConstant  %5  0.05
%24 = OpConstantComposite  %10  %23 %23 %23
%26 = OpTypeStruct %8
%27 = OpTypePointer Uniform %26
%25 = OpVariable  %27  Uniform
%29 = OpTypeStruct %9
%30 = OpTypePointer Uniform %29
%28 = OpVariable  %30  Uniform
%32 = OpTypeStruct %16
%33 = OpTypePointer StorageBuffer %32
%31 = OpVariable  %33  StorageBuffer
%35 = OpTypeStruct %17
%36 = OpTypePointer Uniform %35
%34 = OpVariable  %36  Uniform
%38 = OpTypePointer UniformConstant %19
%37 = OpVariable  %38  UniformConstant
%40 = OpTypePointer UniformConstant %20
%39 = OpVariable  %40  UniformConstant
%45 = OpTypeFunction %5 %7 %4
%48 = OpConstant  %5  0.0
%49 = OpConstant  %5  1.0
%50 = OpConstant  %5  0.5
%51 = OpConstant  %5  -0.5
%54 = OpTypeBool
%70 = OpTypeSampledImage %19
%76 = OpTypePointer Function %11
%77 = OpConstantNull  %11
%80 = OpTypePointer Input %12
%79 = OpVariable  %80  Input
%82 = OpVariable  %80  Input
%85 = OpTypePointer Output %4
%84 = OpVariable  %85  Output
%87 = OpTypePointer Output %10
%86 = OpVariable  %87  Output
%88 = OpVariable  %85  Output
%90 = OpTypeFunction %2
%91 = OpTypePointer Uniform %8
%92 = OpConstant  %7  0
%94 = OpTypePointer Uniform %9
%97 = OpTypePointer Uniform %3
%104 = OpTypePointer Function %10
%112 = OpTypeVector %13 3
%116 = OpConstant  %7  1
%118 = OpTypePointer Function %4
%119 = OpConstant  %7  2
%127 = OpTypePointer Output %5
%134 = OpConstantNull  %10
%136 = OpTypePointer Function %7
%137 = OpConstantNull  %7
%141 = OpTypePointer Input %4
%140 = OpVariable  %141  Input
%144 = OpTypePointer Input %10
%143 = OpVariable  %144  Input
%146 = OpVariable  %141  Input
%148 = OpVariable  %85  Output
%152 = OpTypePointer StorageBuffer %16
%164 = OpTypePointer Uniform %6
%165 = OpTypePointer Uniform %7
%175 = OpTypePointer StorageBuffer %15
%202 = OpTypePointer Uniform %4
%210 = OpVariable  %141  Input
%212 = OpVariable  %144  Input
%214 = OpVariable  %141  Input
%216 = OpVariable  %85  Output
%220 = OpTypePointer Uniform %17
%241 = OpTypePointer Uniform %15
%44 = OpFunction  %5  None %45
%42 = OpFunctionParameter  %7
%43 = OpFunctionParameter  %4
%41 = OpLabel
%46 = OpLoad  %19  %37
%47 = OpLoad  %20  %39
OpBranch %52
%52 = OpLabel
%53 = OpCompositeExtract  %5  %43 3
%55 = OpFOrdLessThanEqual  %54  %53 %48
OpSelectionMerge %56 None
OpBranchConditional %55 %57 %56
%57 = OpLabel
OpReturnValue %49
%56 = OpLabel
%58 = OpCompositeConstruct  %21  %50 %51
%59 = OpCompositeExtract  %5  %43 3
%60 = OpFDiv  %5  %49 %59
%61 = OpVectorShuffle  %21  %43 %43 0 1
%62 = OpFMul  %21  %61 %58
%64 = OpCompositeConstruct  %21  %60 %60
%63 = OpVectorTimesScalar  %21  %62 %64
%65 = OpCompositeConstruct  %21  %50 %50
%66 = OpFAdd  %21  %63 %65
%67 = OpBitcast  %13  %42
%68 = OpCompositeExtract  %5  %43 2
%69 = OpFMul  %5  %68 %60
%71 = OpConvertSToF  %5  %67
%72 = OpCompositeConstruct  %10  %66 %71
%73 = OpSampledImage  %70  %46 %47
%74 = OpImageSampleDrefExplicitLod  %5  %73 %72 %69 Lod %48
OpReturnValue %74
OpFunctionEnd
%89 = OpFunction  %2  None %90
%78 = OpLabel
%75 = OpVariable  %76  Function %77
%81 = OpLoad  %12  %79
%83 = OpLoad  %12  %82
%93 = OpAccessChain  %91  %25 %92
%95 = OpAccessChain  %94  %28 %92
OpBranch %96
%96 = OpLabel
%98 = OpAccessChain  %97  %95 %92
%99 = OpLoad  %3  %98
%100 = OpAccessChain  %97  %95 %92
%101 = OpLoad  %3  %100
%102 = OpConvertSToF  %4  %81
%103 = OpMatrixTimesVector  %4  %101 %102
%105 = OpCompositeExtract  %4  %99 0
%106 = OpVectorShuffle  %10  %105 %105 0 1 2
%107 = OpCompositeExtract  %4  %99 1
%108 = OpVectorShuffle  %10  %107 %107 0 1 2
%109 = OpCompositeExtract  %4  %99 2
%110 = OpVectorShuffle  %10  %109 %109 0 1 2
%111 = OpCompositeConstruct  %14  %106 %108 %110
%113 = OpVectorShuffle  %112  %83 %83 0 1 2
%114 = OpConvertSToF  %10  %113
%115 = OpMatrixTimesVector  %10  %111 %114
%117 = OpAccessChain  %104  %75 %116
OpStore %117 %115
%120 = OpAccessChain  %118  %75 %119
OpStore %120 %103
%121 = OpAccessChain  %97  %93 %92
%122 = OpLoad  %3  %121
%123 = OpMatrixTimesVector  %4  %122 %103
%124 = OpAccessChain  %118  %75 %92
OpStore %124 %123
%125 = OpLoad  %11  %75
%126 = OpCompositeExtract  %4  %125 0
OpStore %84 %126
%128 = OpAccessChain  %127  %84 %116
%129 = OpLoad  %5  %128
%130 = OpFNegate  %5  %129
OpStore %128 %130
%131 = OpCompositeExtract  %10  %125 1
OpStore %86 %131
%132 = OpCompositeExtract  %4  %125 2
OpStore %88 %132
OpReturn
OpFunctionEnd
%149 = OpFunction  %2  None %90
%138 = OpLabel
%133 = OpVariable  %104  Function %134
%135 = OpVariable  %136  Function %137
%142 = OpLoad  %4  %140
%145 = OpLoad  %10  %143
%147 = OpLoad  %4  %146
%139 = OpCompositeConstruct  %11  %142 %145 %147
%150 = OpAccessChain  %91  %25 %92
%151 = OpAccessChain  %94  %28 %92
%153 = OpAccessChain  %152  %31 %92
%154 = OpLoad  %19  %37
%155 = OpLoad  %20  %39
OpBranch %156
%156 = OpLabel
%157 = OpCompositeExtract  %10  %139 1
%158 = OpExtInst  %10  %1 Normalize %157
OpStore %133 %24
OpStore %135 %92
OpBranch %159
%159 = OpLabel
OpLoopMerge %160 %162 None
OpBranch %161
%161 = OpLabel
%163 = OpLoad  %7  %135
%166 = OpAccessChain  %165  %150 %116 %92
%167 = OpLoad  %7  %166
%168 = OpExtInst  %7  %1 UMin %167 %18
%169 = OpULessThan  %54  %163 %168
OpSelectionMerge %170 None
OpBranchConditional %169 %170 %171
%171 = OpLabel
OpBranch %160
%170 = OpLabel
OpBranch %172
%172 = OpLabel
%174 = OpLoad  %7  %135
%176 = OpAccessChain  %175  %153 %174
%177 = OpLoad  %15  %176
%178 = OpLoad  %7  %135
%179 = OpCompositeExtract  %3  %177 0
%180 = OpCompositeExtract  %4  %139 2
%181 = OpMatrixTimesVector  %4  %179 %180
%182 = OpFunctionCall  %5  %44 %178 %181
%183 = OpCompositeExtract  %4  %177 1
%184 = OpVectorShuffle  %10  %183 %183 0 1 2
%185 = OpCompositeExtract  %4  %139 2
%186 = OpVectorShuffle  %10  %185 %185 0 1 2
%187 = OpFSub  %10  %184 %186
%188 = OpExtInst  %10  %1 Normalize %187
%189 = OpDot  %5  %158 %188
%190 = OpExtInst  %5  %1 FMax %48 %189
%191 = OpFMul  %5  %182 %190
%192 = OpCompositeExtract  %4  %177 2
%193 = OpVectorShuffle  %10  %192 %192 0 1 2
%195 = OpCompositeConstruct  %10  %191 %191 %191
%194 = OpVectorTimesScalar  %10  %193 %195
%196 = OpLoad  %10  %133
%197 = OpFAdd  %10  %196 %194
OpStore %133 %197
OpBranch %173
%173 = OpLabel
OpBranch %162
%162 = OpLabel
%198 = OpLoad  %7  %135
%199 = OpIAdd  %7  %198 %116
OpStore %135 %199
OpBranch %159
%160 = OpLabel
%200 = OpLoad  %10  %133
%201 = OpCompositeConstruct  %4  %200 %49
%203 = OpAccessChain  %202  %151 %116
%204 = OpLoad  %4  %203
%205 = OpFMul  %4  %201 %204
OpStore %148 %205
OpReturn
OpFunctionEnd
%217 = OpFunction  %2  None %90
%208 = OpLabel
%206 = OpVariable  %104  Function %134
%207 = OpVariable  %136  Function %137
%211 = OpLoad  %4  %210
%213 = OpLoad  %10  %212
%215 = OpLoad  %4  %214
%209 = OpCompositeConstruct  %11  %211 %213 %215
%218 = OpAccessChain  %91  %25 %92
%219 = OpAccessChain  %94  %28 %92
%221 = OpAccessChain  %220  %34 %92
%222 = OpLoad  %19  %37
%223 = OpLoad  %20  %39
OpBranch %224
%224 = OpLabel
%225 = OpCompositeExtract  %10  %209 1
%226 = OpExtInst  %10  %1 Normalize %225
OpStore %206 %24
OpStore %207 %92
OpBranch %227
%227 = OpLabel
OpLoopMerge %228 %230 None
OpBranch %229
%229 = OpLabel
%231 = OpLoad  %7  %207
%232 = OpAccessChain  %165  %218 %116 %92
%233 = OpLoad  %7  %232
%234 = OpExtInst  %7  %1 UMin %233 %18
%235 = OpULessThan  %54  %231 %234
OpSelectionMerge %236 None
OpBranchConditional %235 %236 %237
%237 = OpLabel
OpBranch %228
%236 = OpLabel
OpBranch %238
%238 = OpLabel
%240 = OpLoad  %7  %207
%242 = OpAccessChain  %241  %221 %240
%243 = OpLoad  %15  %242
%244 = OpLoad  %7  %207
%245 = OpCompositeExtract  %3  %243 0
%246 = OpCompositeExtract  %4  %209 2
%247 = OpMatrixTimesVector  %4  %245 %246
%248 = OpFunctionCall  %5  %44 %244 %247
%249 = OpCompositeExtract  %4  %243 1
%250 = OpVectorShuffle  %10  %249 %249 0 1 2
%251 = OpCompositeExtract  %4  %209 2
%252 = OpVectorShuffle  %10  %251 %251 0 1 2
%253 = OpFSub  %10  %250 %252
%254 = OpExtInst  %10  %1 Normalize %253
%255 = OpDot  %5  %226 %254
%256 = OpExtInst  %5  %1 FMax %48 %255
%257 = OpFMul  %5  %248 %256
%258 = OpCompositeExtract  %4  %243 2
%259 = OpVectorShuffle  %10  %258 %258 0 1 2
%261 = OpCompositeConstruct  %10  %257 %257 %257
%260 = OpVectorTimesScalar  %10  %259 %261
%262 = OpLoad  %10  %206
%263 = OpFAdd  %10  %262 %260
OpStore %206 %263
OpBranch %239
%239 = OpLabel
OpBranch %230
%230 = OpLabel
%264 = OpLoad  %7  %207
%265 = OpIAdd  %7  %264 %116
OpStore %207 %265
OpBranch %227
%228 = OpLabel
%266 = OpLoad  %10  %206
%267 = OpCompositeConstruct  %4  %266 %49
%268 = OpAccessChain  %202  %219 %116
%269 = OpLoad  %4  %268
%270 = OpFMul  %4  %267 %269
OpStore %216 %270
OpReturn
OpFunctionEnd